<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>单例模式 | 前端学习与摸鱼艺术</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/fav.png">
    <meta name="description" content="blog；frontend developer；">
    
    <link rel="preload" href="/assets/css/0.styles.f47b8e7c.css" as="style"><link rel="preload" href="/assets/js/app.071cd255.js" as="script"><link rel="preload" href="/assets/js/2.4273f165.js" as="script"><link rel="preload" href="/assets/js/3.22a93f47.js" as="script"><link rel="prefetch" href="/assets/js/10.8e8c3587.js"><link rel="prefetch" href="/assets/js/11.62eda90a.js"><link rel="prefetch" href="/assets/js/12.664b49b9.js"><link rel="prefetch" href="/assets/js/13.69662d95.js"><link rel="prefetch" href="/assets/js/14.4446e6c3.js"><link rel="prefetch" href="/assets/js/15.92ec6d48.js"><link rel="prefetch" href="/assets/js/16.be52545c.js"><link rel="prefetch" href="/assets/js/17.dde73455.js"><link rel="prefetch" href="/assets/js/18.6dad4d17.js"><link rel="prefetch" href="/assets/js/19.655e0e4d.js"><link rel="prefetch" href="/assets/js/20.ed08ebea.js"><link rel="prefetch" href="/assets/js/21.66a57168.js"><link rel="prefetch" href="/assets/js/22.36bcce31.js"><link rel="prefetch" href="/assets/js/4.f5b78cf2.js"><link rel="prefetch" href="/assets/js/5.880d05f7.js"><link rel="prefetch" href="/assets/js/6.15993fb5.js"><link rel="prefetch" href="/assets/js/7.b0a25221.js"><link rel="prefetch" href="/assets/js/8.03582686.js"><link rel="prefetch" href="/assets/js/9.25b92fb7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f47b8e7c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端学习与摸鱼艺术</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
    首页
  </a></div><div class="nav-item"><a href="https://github.com/MatRunner/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.yuque.com/mouzaixiulianneigongdeyangtongxue" target="_blank" rel="noopener noreferrer" class="nav-link external">
    语雀
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
    首页
  </a></div><div class="nav-item"><a href="https://github.com/MatRunner/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.yuque.com/mouzaixiulianneigongdeyangtongxue" target="_blank" rel="noopener noreferrer" class="nav-link external">
    语雀
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/" class="sidebar-heading clickable router-link-active"><span>介绍</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/" aria-current="page" class="sidebar-link">关于本博客</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/tech/introduction" class="sidebar-heading clickable"><span>踩坑合集</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/npm.html" class="sidebar-link">如何发布一个npm包</a></li><li><a href="/tech/webpack_export.html" class="sidebar-link">使用webpack打出一个有导出的包</a></li><li><a href="/tech/about_const.html" class="sidebar-link">竟然被const坑了一把</a></li><li><a href="/tech/sso.html" class="sidebar-link">集成sso的前端项目在开发阶段绕过登陆</a></li><li><a href="/tech/md_parser.html" class="sidebar-link">面向业务的Markdown解析脚本</a></li><li><a href="/tech/resizeObserver.html" class="sidebar-link">浅用ResizeObserver API</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/fish/introduction" class="sidebar-heading clickable"><span>摸鱼杂谈</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/fish/材料那几年.html" class="sidebar-link">材料那几年</a></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/design-pattern/introduction" class="sidebar-heading clickable open"><span>设计模式思考与实践</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/design-pattern/singleton.html" aria-current="page" class="active sidebar-link">单例模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/design-pattern/singleton.html#场景复现" class="sidebar-link">场景复现</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h1> <blockquote><p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p></blockquote> <p>业务中更加形象的理解是：只要这是一个全局唯一的功能，都可以使用单例模式。甚至在有经验的前端看来，单例模式就是一种自然而然的写法。比如一个登录弹窗，显然是全局唯一的，无论在项目的哪个地方调用了这个弹窗，都应该始终使用的是这同一个弹窗。</p> <h2 id="场景复现"><a href="#场景复现" class="header-anchor">#</a> 场景复现</h2> <h3 id="弹窗"><a href="#弹窗" class="header-anchor">#</a> 弹窗</h3> <p>我经历过的一个场景是，一个卡片列表，点击卡片会弹窗（项目中为antd的Modal），一个时刻只有一个弹窗，弹窗只和这个卡片有值传递，那么这个弹窗要写在哪呢？</p> <p>有两种方案，一种是基于弹窗和卡片有值传递，那么这个弹窗应该放在卡片组件内。但是这样带来的潜在问题是，有多少个卡片，就会有多少个弹窗。虽然这影响并不大，只会在切换弹窗的时候对弹窗的dom节点反复卸载安装，也不怎么影响性能。当然，这是直觉上的判断，具体还是需要根据Modal组件的实现来判断的。然后我就顺着组件库找到了<code>rc-dialog</code>，稍微看了下源码我就知道不是一时半会能解决的了。所以先来一波逆向！
在<a href="https://dialog-react-component.vercel.app/demo/ant-design" target="_blank" rel="noopener noreferrer">rc-dialog的demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中，可以先浅看一下dom结构：</p> <p><img src="/assets/img/singleton_1.6c47125b.png" alt="rc-dialog的demo的dom结构1"> <img src="/assets/img/singleton_2.9ee9a223.png" alt="rc-dialog的demo的dom结构2"></p> <p>可以发现，有多少个modal（这里叫dialog），就会在body上append几个div，这些div就是modal的container了。我原本预想的是rc-dialog使用单例模式实现全局唯一的一个弹窗，但是组件开发者显然比我考虑的更周全，它这个弹窗是可以呼出另一个弹窗来任意嵌套的。所以并没有限制弹窗数量。但我发现了另一个值得学习的点，modal实现了惰性单例，只有在点击的时候才会创建一个div并append到body上。这样看来，第一种方案modal放在card组件中就不合适了，用户每点一个card，就会在body上append一个div，虽然Chrome很强大，再多点div也不会怎么样，但是在学过设计模式的码农看来就不太好接受了。</p> <p><em>另外，可能我的同事也发现了这个奇怪的地方，但是他的做法是<code>{visible &amp;&amp; &lt;Modal visible={visible}&gt;}</code>，虽然body上最多只有一个modal的container了，但是这样频繁的remove和append。。。Chrome天下第一！</em>
第二种方案就是将Modal放在card的同一级，所有的card点击后呼出的都是同一个Modal。这种实现方式下，考虑的props的传递问题更多一点，因为Modal中的内容由card决定，但已经不属于设计模式的范畴了。</p> <h3 id="子菜单"><a href="#子菜单" class="header-anchor">#</a> 子菜单</h3> <p>菜单是一个十分常见的业务组件，但是基于UI不同，实现方式可能大相庭径。如果没有特殊要求，随手一个<code>type Menu = {label:string, value:unknow, children?:Menu[]}</code>，然后递归渲染，一个简单的菜单就出来了。而我遇到的需求类似于<a href="https://preview.pro.antdv.com/dashboard/workplace" target="_blank" rel="noopener noreferrer">antd pro vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的菜单。这里只关注收起状态下一级菜单呼出二级菜单的方式。</p> <p><img src="/assets/img/singleton_3.090ff010.png" alt="antd pro vue menu"></p> <p>细细一想这个二级菜单的交互要注意的功能还不少：</p> <ol><li>在一级菜单上移动，二级菜单可以认为是瞬时移动到对应的一级菜单旁边的；</li> <li>鼠标从菜单上移开时，二级菜单不是瞬时消失的，二级菜单和一级菜单并不是紧挨着的，如果是瞬时消失，显然鼠标用于不可能hover到二级菜单上。</li></ol> <p>这个二级菜单也有两种实现方式，一种是每一个一级菜单都包含有其二级菜单的dom节点，这样可以把大部分的交互效果用css实现；另一种方式是二级菜单是一个单例容器，根据hover到不同的一级菜单而append不同的子节点。
antd使用的就是第一种方案，而我则以单例模式的思路实现了效果基本相同的一个menu。👉<a href="https://github.com/MatRunner/react-practice" target="_blank" rel="noopener noreferrer">源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。之所以说基本相同，是在“二级菜单只有一个dom容器”的实现下，一级菜单的hover状态改变时，二级菜单可以出现平移效果，antd的菜单则实现不出该效果。
当然，经过我的事后反思，antd的实现方式的优势更大。扩展性上，嵌套的结构容易实现对多级菜单的渲染，而且各级菜单的相对位置容易计算，单例模式实现的二级菜单是通过js实时计算出二级菜单的位置的，拓展性不佳；性能上来说，antd也更佳，menu渲染完毕后，交互行为大部分是由css来控制的，js基本在控制类名，而单例实现的menu，改变一级菜单就要计算二级菜单的位置，并根据二级菜单的内容对容器内进行dom的增删；虽然这对现代浏览器来说问题不大，但是在极限情况下，菜单层级深，子菜单类别繁多时，性能瓶颈出现的更早。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新于:</span> <span class="time">8/8/2022, 10:00:11 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/fish/材料那几年.html" class="prev">
          材料那几年
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.071cd255.js" defer></script><script src="/assets/js/2.4273f165.js" defer></script><script src="/assets/js/3.22a93f47.js" defer></script>
  </body>
</html>
